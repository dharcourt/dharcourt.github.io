var Component = require("montage/ui/component").Component;
/**
 * @class LocationBrowser
 * @extends Component
 */
exports.LocationBrowser = Component.specialize(/** @lends LocationBrowser# */ {

    _coordinatesPane: {
        get: function () {
            return require.async("ui/location/location-inspector.reel").then(function(exports) {
                return new exports.LocationInspector();
            });
        }
    },

    _textPane: {
        get: function () {
            return require.async("ui/location/location-search-list.reel").then(function(exports) {
                return new exports.LocationSearchList();
            });
        }
    },

    _mapExportInspector: {
        value: undefined
    },

    _mapExportInspectorPromise: {
        value: undefined
    },

    handleMenuAction: {
        value: function (e) {

            e.stopPropagation();
            var actionKey = e.detail.item.value,
                self = this,
                exportFormat;

            exportFormat =  actionKey === "exportToKml" ? "kml" :
                            actionKey === "exportToGpx" ? "gpx" :
                            actionKey === "exportToJpeg" ? "jpeg" : undefined;

            if (exportFormat) {
                if (this._mapExportInspector) {
                    this._mapExportInspector.filename = exportFormat.toUpperCase() + " Export";
                    this._mapExportInspector.format = exportFormat;
                    this.succession.components.push(this._mapExportInspector);
                } else if (! this._mapExportInspectorPromise) {
                    this._mapExportInspectorPromise = require.async("ui/location/map-export-inspector.reel");
                    this._mapExportInspectorPromise.then(function (exports) {
                        self._mapExportInspector = new exports.MapExportInspector();
                        self._mapExportInspector.succession = self.succession;
                        self._mapExportInspector.filename = exportFormat.toUpperCase() + " Export";
                        self._mapExportInspector.format = exportFormat;
                        self.succession.components.push(self._mapExportInspector);
                    });
                }
            }
        }
    },

    succession: {
        get: function () {
            return this._succession;
        },
        set: function (value) {
            if (value) {
                this._succession = value;
                this._succession.content = this._locationSearchList;
            }
        }
    }

});
