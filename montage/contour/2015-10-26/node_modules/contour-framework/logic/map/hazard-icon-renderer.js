/**
 * @module logic/hazard-icon-renderer.js
 */
var Renderer = require("logic/map/renderer").Renderer,
    EsriGeometryType = require("logic/map/esri-geometry-type").EsriGeometryType,
    HazardIcon = require("logic/model/hazard-icon").HazardIcon,
    NewHazard = require("logic/model/hazard").Hazard;

/**
 * @class HazardIconRenderer
 * @extends Renderer
 *
 * This object is used by the PDC Active Hazards layer to render it's hazards.
 */
exports.HazardIconRenderer = Renderer.specialize(/** @lends HazardIconRenderer.prototype */ {

    constructor: {
        value: function HazardIconRenderer() {
            this.geometryType = EsriGeometryType["esriGeometryPoint"];
        }
    },

    _renderPoint: {
        value: function (properties) {
            var style, category, severity, type, icon;

            if (properties.categoryId !== undefined) {
                category = NewHazard.Category.forId(properties.categoryId);
                severity = NewHazard.Severity.forId(properties.severityId);
                type = NewHazard.Type.forId(properties.typeId);
                icon = HazardIcon.get(category, severity, type);
                if (icon) {
                    style = {
                        url: icon.url,
                        anchor: {x: icon.size / 4, y: icon.size / 4},
                        scaledSize: {width: icon.size / 2, height: icon.size / 2},
                        size: {width: icon.size, height: icon.size}
                    };
                }
            } else if (properties.clusterCenter) {
                style = {
                    fillColor: "#FF0000",
                    fillOpacity: 1.0,
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 2,
                    strokeColor: "#FF0000",
                    strokeWeight: 3
                };
            } else if (properties.spoke) {
                style = {
                    strokeColor: "#FF0000",
                    strokeWeight: 2
                };
            }

            return style;
        }
    },

    export: {
        value: function (properties) {
            var icon = STATIC_HAZARD_ICONS[properties.typeId] || properties.typeId.toLowerCase();
            return {
                url: "http://static.pdc.org/icons/hazard/large/" + icon + ".png",
                size: {
                    width: 60,
                    height: 60
                },
                scaledSize: {
                    width: 30,
                    height: 30
                }
            };
        }
    }
});

var STATIC_HAZARD_ICONS = {
    BIOMEDICAL: "bio_medical",
    MANMADE: "man_made",
    HIGHSURF: "high_surf",
    HIGHWIND: "high_wind",
    EXTREMETEMPERATURE: "extreme_temperature",
    WINTERSTORM: "winter_storm"
};
