/**
 * @module logic/link-service.js
 */
var ObjectService = require("logic/mock-montage-data/object-service").ObjectService,
    ObjectStream = require("logic/mock-montage-data/object-stream").ObjectStream,
    LinkCategory = require("logic/model/link-category").LinkCategory;


/**
 * @class LinkService
 * @extends ObjectService
 */
var LinkService = exports.LinkService = ObjectService.specialize(/** @lends LinkService.prototype */ {

    constructor: {
        value: function LinkService() {
            this.super("linkService");
        }
    },
    query: {
        value: function (selector) {

            var stream = new ObjectStream(selector);
            this._fetchLinks(stream);

            return stream;
        }
    },

    _fetchLinks: {
        value: function(stream) {
            var url = "http://emopstest.pdc.org/emops/config/links.xml",
                request = new XMLHttpRequest();

            request.onload = this._onLoad.bind(this, request, stream);
            request.open("get",url);
            request.withCredentials = true;
            request.send();
        }
    },

    _onLoad: {
        value: function(request, stream) {
            var data = request.responseXML.getElementsByTagName('category'),
                categories = [], i, length, category;

            for (i = 0, length = data.length; i < length; i++) {
                category = LinkCategory.initialize(data[i]);
                stream.add(category);
                categories.push(category);
            }
            stream.resolve(categories);
        }
    }

});
