var Montage = require("montage").Montage,
    FileSaver = require("FileSaver.js");

var FileExport = exports.FileExport = Montage.specialize(/** @lends IdentifySummary.prototype */ {

    file: { value: null },

    fileName: { value: null },

    saveFile: {
        value: function () {
            var encodedUri,
                blob;
            this.file = "\uFEFF" + this.file;
            blob = new Blob([this.file], {type: "text/csv;charset=utf-8"});
            if (FileExport._isSafari) {
                var reader = new FileReader();
                reader.onloadend = function() {
                    var base64Data = reader.result;
                    window.location.href = "data:attachment/file" + base64Data.slice(base64Data.search(/[,;]/));
                };
                reader.readAsDataURL(blob);
            } else {
                FileSaver.saveAs(blob, this.fileName);
            }

        }
    }

}, {

    __isSafari: {
        value: null
    },

    initializeFileExport: {
        value: function (data, fileName) {
            var fileExport = new FileExport();
            fileExport.file = data;
            fileExport.fileName = fileName;

            return fileExport;
        }
    },

    _isSafari: {
        get: function () {
            if (FileExport.__isSafari === null) {
                FileExport.__isSafari = navigator.userAgent.search("Safari") >= 0 && navigator.userAgent.search("Chrome") < 0;
            }
            return FileExport.__isSafari;
        }
    }

});
